<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fly me, 'til you can!</title>
      <link href="/CSS/style.css" rel="stylesheet">
</head>
<body>

<div class ="container">
    <h2>Choose your destination!</h2>
    <button id = "back" class = "button-19" role="button">Back</button>
    </div>
<div class="main">
<article class="card" id = "status">
<h3 id="round"> Airport info</h3>
    <ul id="info">
    </ul>
</article>
     <div class="map"></div>
    </div>
    <div id ="choice_des">
        <button id = "des1" class = "button-19" onclick="des1()">Destination 1</button>
        <button id = "des2" class = "button-19" onclick="des2()">Destination 2</button>
        <button id = "des3" class = "button-19" onclick="des3()">Destination 3</button>
        <button id = "des4" class = "button-19" onclick="des4()">Destination 4</button>
        <button id = "des5" class = "button-19" onclick="des5()">Destination 5</button>
    </div>
</div>

<footer>
<button id = "start" class = "button-19" role="button" onclick="location.href='event.html'">Let's fly!</button>
</footer>
<script>
  'use strict';
  const back = document.getElementById('back');
  back.addEventListener('click',(evt)=>{
    confirm(`Are you sure you want to go back to choosing the airplane?
    You'll lose one of your turns to make a change.

    Your remaining chance(s): `)
    if (back){
      back.onclick= location.href='choice.html'
    }
  })

  //map




  //info panel
let desArr =[];
  let calArr =[];
async function cal_distance() {
    try {
      const userid = 'test_player'; //ph
      const size = 'large_airport'; //ph
        const response = await fetch(`http://127.0.0.1:3000/current/${userid}`); //current location
        const jsonData = await response.json();
        console.log(jsonData);
        const left_co2 = jsonData[3]- jsonData[4];

        const response2 = await fetch(`http://127.0.0.1:3000/destination/${size}`); //candidate locations
        const jsonData2 = await response2.json();
        console.log(jsonData2);

        for (let des of jsonData2){
          desArr.push([des[3],des[4],des[5]])
        }
        console.log(desArr)



        const current_lat = parseFloat(jsonData[1]);
        const current_lon = parseFloat(jsonData[2]);


        for (let des of jsonData2) {
          const des_lat = parseFloat(des[1]);
          const des_lon = parseFloat(des[2]);

          const url = `https://distance-calculator8.p.rapidapi.com/calc?startLatitude=${current_lat}&startLongitude=${current_lon}&endLatitude=${des_lat}&endLongitude=${des_lon}`;
          const options = {
            method: 'GET',
            headers: {
              'X-RapidAPI-Key': '881baf1ebbmshbafb5a2bc01a4fap185d4djsn1861d69602b0',
              'X-RapidAPI-Host': 'distance-calculator8.p.rapidapi.com'
            }
          };

          try {
            const response = await fetch(url, options);
            const result = await response.json();
            const kilometers = result.body.distance.kilometers;
            //console.log(kilometers); // distance in km

            const range = parseFloat(des[6]);
            const capacity = parseFloat(des[7]);

            const co2Emit = kilometers * range / capacity;
            //console.log(co2Emit);
            if (range < kilometers || left_co2 < co2Emit){
              jsonData2.remove(des);

            }
            calArr.push([co2Emit,kilometers]);


          } catch (error) {
          }
        }
  } catch (err){
    console.log(err.message);}
}

console.log(calArr);

const info = document.getElementById('info');
function des1() {
  const info = document.getElementById('info');

  const li1 = document.createElement('li');
  li1.textContent = `Airport name: ${desArr[0][0]}`;

  const li2 = document.createElement('li');
  li2.textContent = `Location : ${desArr[0][1]}, ${desArr[0][2]}`;

  const li3 = document.createElement('li');
  li3.textContent = `Expected Co2 Consumption: ${Math.floor(calArr[0][0])} g`;

  const li4 = document.createElement('li');
  li4.textContent = `Distance from your location:${Math.floor(calArr[0][1])} km` ;

  info.innerHTML = ''; // Clear existing content
  info.appendChild(li1);
  info.appendChild(li2);
  info.appendChild(li3);
  info.appendChild(li4);
}
function des2() {
    const info = document.getElementById('info');

    const li1 = document.createElement('li');
    li1.textContent = `Airport name: ${desArr[1][0]}`;

    const li2 = document.createElement('li');
    li2.textContent = `Location : ${desArr[1][1]}, ${desArr[1][2]}`;

    const li3 = document.createElement('li');
  li3.textContent = `Expected Co2 Consumption: ${Math.floor(calArr[1][0])} g`;

  //if the destination is not available, err handling (eg. show no destination on the display!)

  const li4 = document.createElement('li');
  li4.textContent = `Distance from your location:${Math.floor(calArr[1][1])} km` ;

    info.innerHTML = ''; // Clear existing content
    info.appendChild(li1);
    info.appendChild(li2);
    info.appendChild(li3);
    info.appendChild(li4);}

  function des3() {
    const info = document.getElementById('info');

    const li1 = document.createElement('li');
    li1.textContent = `Airport name: ${desArr[2][0]}`;

    const li2 = document.createElement('li');
    li2.textContent = `Location : ${desArr[2][1]}, ${desArr[2][2]}`;

    const li3 = document.createElement('li');
  li3.textContent = `Expected Co2 Consumption: ${Math.floor(calArr[2][0])} g`;

  const li4 = document.createElement('li');
  li4.textContent = `Distance from your location:${Math.floor(calArr[2][1])} km` ;

    info.innerHTML = ''; // Clear existing content
    info.appendChild(li1);
    info.appendChild(li2);
    info.appendChild(li3);
    info.appendChild(li4);}

  function des4() {
    const info = document.getElementById('info');

    const li1 = document.createElement('li');
    li1.textContent = `Airport name: ${desArr[3][0]}`;

    const li2 = document.createElement('li');
    li2.textContent = `Location : ${desArr[3][1]}, ${desArr[3][2]}`;

    const li3 = document.createElement('li');
  li3.textContent = `Expected Co2 Consumption: ${Math.floor(calArr[3][0])} g`;

  const li4 = document.createElement('li');
  li4.textContent = `Distance from your location:${Math.floor(calArr[3][1])} km` ;

    info.innerHTML = ''; // Clear existing content
    info.appendChild(li1);
    info.appendChild(li2);
    info.appendChild(li3);
    info.appendChild(li4);}

  function des5() {
    const info = document.getElementById('info');

    const li1 = document.createElement('li');
    li1.textContent = `Airport name: ${desArr[4][0]}`;

    const li2 = document.createElement('li');
    li2.textContent = `Location : ${desArr[4][1]}, ${desArr[4][2]}`;

    const li3 = document.createElement('li');
  li3.textContent = `Expected Co2 Consumption: ${Math.floor(calArr[4][0])} g`;

  const li4 = document.createElement('li');
  li4.textContent = `Distance from your location:${Math.floor(calArr[4][1])} km` ;

    info.innerHTML = ''; // Clear existing content
    info.appendChild(li1);
    info.appendChild(li2);
    info.appendChild(li3);
    info.appendChild(li4);}

cal_distance();
</script>
</body>