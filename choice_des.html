<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fly me, 'til you can!</title>
      <link href="/CSS/style.css" rel="stylesheet">
</head>
<body>

<div class ="container">
    <h2>Choose your destination!</h2>
    <button id = "back" class = "button-19" role="button">Back</button>
    </div>
<div class="main">
<article class="card" id = "status">
<h3 id="round"> Airport info</h3>
    <ul>
        <li>Airport name:</li>
        <li>Location :</li>
        <li>Expected Co2 Consumption:</li>
        <li>Distance from your location:</li>
    </ul>
</article>
     <div id="des_map">
<img id="map_ph" src = 'https://via.placeholder.com/210x295?text=map' width="830px" height="600px" alt = "map">
    </div>
    <div id ="choice_des">
        <button id = "des1" class = "button-19" onclick="change1()">Destination 1</button>
        <button id = "des2" class = "button-19" onclick="change2()">Destination 2</button>
        <button id = "des3" class = "button-19" onclick="change3()">Destination 3</button>
        <button id = "des4" class = "button-19" onclick="change4()">Destination 4</button>
        <button id = "des5" class = "button-19" onclick="change5()">Destination 5</button>
    </div>
</div>

<footer>
<button id = "start" class = "button-19" role="button" onclick="location.href='event.html'">Let's fly!</button>
</footer>
<script>
  'use strict';
  const back = document.getElementById('back');
  back.addEventListener('click',(evt)=>{
    confirm(`Are you sure you want to go back to choosing the airplane?
    You'll lose one of your turns to make a change.

    Your remaining chance(s): `)
    if (back){
      back.onclick= location.href='choice.html'
    }
  })


async function cal_distance() {
    try {
      const userid = 'test_player'; //ph
      const size = 'large_airport'; //ph
        const response = await fetch(`http://127.0.0.1:3000/current/${userid}`); //current location
        const jsonData = await response.json();
        console.log(jsonData);
        const left_co2 = jsonData[3]- jsonData[4];

        const response2 = await fetch(`http://127.0.0.1:3000/destination/${size}`); //candidate locations
        const jsonData2 = await response2.json();
        console.log(jsonData2);
        //let desArr =[];
        for (let des of jsonData2){
          //desArr.push((des[3],des[4], des[5]))
        }
        //console.log(desArr)
        const range = jsonData2[6];
        const capacity = jsonData[7];


        const current_lat = parseFloat(jsonData[1]);
        const current_lon = parseFloat(jsonData[2]);


        for (let des of jsonData2) {
          const des_lat = parseFloat(des[1]);
          const des_lon = parseFloat(des[2]);

          const url = `https://distance-calculator8.p.rapidapi.com/calc?startLatitude=${current_lat}&startLongitude=${current_lon}&endLatitude=${des_lat}&endLongitude=${des_lon}`;
          const options = {
            method: 'GET',
            headers: {
              'X-RapidAPI-Key': '881baf1ebbmshbafb5a2bc01a4fap185d4djsn1861d69602b0',
              'X-RapidAPI-Host': 'distance-calculator8.p.rapidapi.com'
            }
          };

          try {
            const response = await fetch(url, options);
            const result = await response.json();
            const kilometers = result.body.distance.kilometers;
            console.log(kilometers); // distance in km
            const co2Emit = kilometers * range / capacity;
            des.push(co2Emit, kilometers)
            if (range < kilometers || left_co2 < co2Emit){
              jsonData2.remove(des);

            }



          } catch (error) {
          }
        }
  } catch (err){
    console.log(err.message);}
}


cal_distance();
</script>